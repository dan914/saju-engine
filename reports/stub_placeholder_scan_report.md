# Stub/Placeholder/Mock Scan Report

**Date:** 2025-10-09 KST
**Scope:** Complete codebase scan across 8 sectors
**Total Markers Found:** 20

---

## Executive Summary

Systematic scan of the entire Saju codebase identified **20 markers** across 8 logical sectors:

- **Critical markers:** 3 (cross-service import TODOs)
- **Medium priority:** 7 (placeholder logic in core engines)
- **Low priority:** 6 (placeholder comments/structures)
- **False positives:** 4 (documentation TBD markers)

**Key finding:** Most markers are in `services/analysis-service/app/core/` related to incomplete feature implementations (season adjustments, month stem effects, climate advice).

---

## Sector-by-Sector Results

### ‚úÖ Sector 1: Policy Files (policy/*.json)

**Files scanned:** 5
**Markers found:** 0

**Status:** CLEAN ‚úÖ

All policy files are production-ready with RFC-8785 signatures.

---

### ‚úÖ Sector 2: Schema Files (schema/*.json)

**Files scanned:** 9
**Markers found:** 0

**Status:** CLEAN ‚úÖ

All schema files are complete JSON Schema draft-2020-12 definitions.

---

### ‚ö†Ô∏è Sector 3: Core Engines (services/analysis-service/app/core/*.py)

**Files scanned:** 20
**Markers found:** 8

**Status:** NEEDS ATTENTION ‚ö†Ô∏è

| File | Line | Marker Type | Content | Severity |
|------|------|-------------|---------|----------|
| `climate.py` | 43 | placeholder | `"advice_bucket": []  # placeholder for future advice mapping` | LOW |
| `engine.py` | 73 | placeholder | `# Strength scoring placeholder.` | LOW |
| `engine.py` | 117 | placeholder | `"notes": "generated by placeholder engine"` | LOW |
| `luck.py` | 12 | TODO | `# TODO: Fix cross-service imports` | **CRITICAL** |
| `luck.py` | 18 | placeholder | `"""Temporary placeholder for SimpleSolarTermLoader"""` | **CRITICAL** |
| `luck.py` | 24 | placeholder | `"""Temporary placeholder for TimeResolver"""` | **CRITICAL** |
| `strength.py` | 377 | placeholder | `# Season adjust - placeholder for now` | MEDIUM |
| `strength.py` | 380 | placeholder | `# Month stem effect - placeholder` | MEDIUM |

**Analysis:**

1. **luck.py cross-service import issues (CRITICAL):**
   - Lines 12, 18, 24 show placeholder classes for `SimpleSolarTermLoader` and `TimeResolver`
   - These are temporary stubs to avoid cross-service import errors (Python module names with hyphens)
   - **Action required:** Move shared classes to `services/common/` as documented in FIX_COMPLETE_REPORT.md

2. **strength.py calculation placeholders (MEDIUM):**
   - Lines 377, 380 show incomplete season/month stem adjustments
   - Currently using simplified scoring (always 0)
   - **Action required:** Implement full season adjustment logic per strength_policy_v2.json

3. **climate.py advice mapping (LOW):**
   - Line 43 shows empty `advice_bucket` placeholder
   - Feature planned but not yet implemented
   - **Action required:** Design and implement advice mapping system

4. **engine.py placeholder notes (LOW):**
   - Lines 73, 117 contain placeholder comments/strings
   - No functional impact (just documentation)
   - **Action required:** Update comments when features are complete

---

### ‚úÖ Sector 4: Policy Engines (core/policy_engines/**/*.py)

**Files scanned:** 0 (directory not found)
**Markers found:** 0

**Status:** N/A

Expected directory `core/policy_engines/` does not exist. Policy engines are currently embedded in `services/analysis-service/app/core/`.

---

### ‚ö†Ô∏è Sector 5: Service Implementations (services/**/*.py excluding core)

**Files scanned:** 18
**Markers found:** 4

**Status:** MINOR ISSUES ‚ö†Ô∏è

| File | Line | Marker Type | Content | Severity |
|------|------|-------------|---------|----------|
| `services/analysis-service/app/models/analysis.py` | 19 | placeholder | `"""Optional toggles (placeholder for future customization)."""` | LOW |
| `services/analysis-service/app/models/analysis.py` | 25 | placeholder | `"""Mapping of stem relationships (placeholder structure)."""` | LOW |
| `services/analysis-service/tests/test_shensha_v2_policy.py` | 79 | placeholder | `# Allow placeholders for now (e.g., <SIG_ELEMENTS>)` | LOW |
| `services/analysis-service/tests/test_shensha_v2_policy.py` | 142 | placeholder | `"""P8 ‚Äî Evidence trace structure must be complete (placeholder test)."""` | LOW |

**Analysis:**

1. **analysis.py model placeholders (LOW):**
   - Lines 19, 25 show docstrings marking future extension points
   - Models are functional, just flagging planned enhancements
   - **Action required:** None immediately, update when features added

2. **test_shensha_v2_policy.py test placeholders (LOW):**
   - Lines 79, 142 show test cases for incomplete features
   - Tests are intentionally relaxed for future expansion
   - **Action required:** Tighten test assertions when features complete

---

### ‚úÖ Sector 6: Test Files (tests/**/*.py, tests/**/*.jsonl)

**Files scanned:** 4
**Markers found:** 0

**Status:** CLEAN ‚úÖ

All test files (JSONL test cases) are complete with no markers.

---

### ‚úÖ Sector 7: Policy Signature Auditor (policy_signature_auditor/*.py)

**Files scanned:** 11
**Markers found:** 1 (false positive)

**Status:** CLEAN ‚úÖ

| File | Line | Marker Type | Content | Severity |
|------|------|-------------|---------|----------|
| `jcs.py` | 7 | XXX | `- Strings escaped (\\, ", control chars ‚Üí \\uXXXX)` | FALSE POSITIVE |

**Analysis:**

Line 7 is a documentation comment explaining escape sequences in JCS canonicalization. Not a code marker. PSA module is production-ready.

---

### ‚ö†Ô∏è Sector 8: Scripts and Utilities (scripts/*.py, tools/*.py)

**Files scanned:** 35
**Markers found:** 7

**Status:** MINOR ISSUES ‚ö†Ô∏è

| File | Line | Marker Type | Content | Severity |
|------|------|-------------|---------|----------|
| `scripts/dt_compare.py` | 8 | TODO | `# TODO: Fix cross-service import - hyphens in module names not supported` | MEDIUM |
| `scripts/dt_compare.py` | 13 | placeholder | `"""Temporary placeholder for DeltaTPolicy to fix CI."""` | MEDIUM |
| `scripts/extrapolate_terms.py` | 120 | placeholder | `"lambda_deg": "0",  # placeholder, not needed for month resolution` | LOW |
| `tools/stage2_audit.py` | 681 | TBD | `**Actual:** TBD` | FALSE POSITIVE |
| `tools/stage2_audit.py` | 697 | TBD | `**Actual:** TBD` | FALSE POSITIVE |
| `tools/stage2_audit.py` | 713 | TBD | `**Actual:** TBD` | FALSE POSITIVE |
| `tools/stage2_audit.py` | 729 | TBD | `# TBD: Add when runtime available` | FALSE POSITIVE |

**Analysis:**

1. **dt_compare.py cross-service import (MEDIUM):**
   - Lines 8, 13 show same cross-service import issue as luck.py
   - Another instance of placeholder class for `DeltaTPolicy`
   - **Action required:** Same fix as luck.py - move to `services/common/`

2. **extrapolate_terms.py lambda placeholder (LOW):**
   - Line 120 shows hardcoded "0" for lambda_deg
   - Comment explains it's intentionally unused for month-level resolution
   - **Action required:** None (intentional simplification)

3. **stage2_audit.py TBD markers (FALSE POSITIVES):**
   - Lines 681, 697, 713, 729 are template strings in report generation
   - These are intentional placeholders for runtime data population
   - **Action required:** None (legitimate report templates)

---

## Priority Action Plan

### üî¥ CRITICAL (Blocking Production)

**1. Fix cross-service import architecture**

**Location:**
- `services/analysis-service/app/core/luck.py:12,18,24`
- `scripts/dt_compare.py:8,13`

**Issue:**
Python module names with hyphens (e.g., `tz-time-service`) cannot be imported. Currently using placeholder classes.

**Solution:**
```bash
# Create services/common/ for shared classes
mkdir -p services/common/saju_common
touch services/common/saju_common/__init__.py

# Move shared classes:
# - SimpleSolarTermLoader
# - TimeResolver
# - DeltaTPolicy

# Update imports across all services
# Update PYTHONPATH in tests and CI
```

**Expected effort:** 4-6 hours
**Risk:** Medium (requires testing across all services)
**Documented in:** FIX_COMPLETE_REPORT.md (lines 280-355)

---

### üü° MEDIUM (Functional Gaps)

**2. Implement season/month stem adjustments in StrengthEvaluator**

**Location:** `services/analysis-service/app/core/strength.py:377,380`

**Issue:**
Season adjust and month stem effect logic are placeholders (always return 0).

**Solution:**
```python
# strength.py:377-385
def _season_adjust(self, day_stem: str, month_branch: str) -> int:
    """Season adjustment per strength_policy_v2.json"""
    season = self._get_season(month_branch)
    element = STEM_TO_ELEMENT[day_stem]

    # Implement full logic from policy
    if season == "spring" and element == "Êú®":
        return 10  # Êú®Êó∫ÊñºÊò•
    # ... (complete all season/element combinations)

def _month_stem_effect(self, day_stem: str, month_stem: str) -> int:
    """Month stem effect per strength_policy_v2.json"""
    # Implement ÊØîÂä´/Âç∞ÈÄè detection logic
    return self.policy["stem_visible_scores"].get(relationship, 0)
```

**Expected effort:** 2-3 hours
**Risk:** Low (isolated to StrengthEvaluator)
**Policy reference:** strength_policy_v2.json lines 45-67

**3. Implement DeltaTPolicy class for dt_compare.py**

**Location:** `scripts/dt_compare.py:13`

**Issue:**
Placeholder class prevents accurate ŒîT calculations for historical dates.

**Solution:**
Either move to `services/common/` or implement full class in scripts/ with proper solar term loading.

**Expected effort:** 2-3 hours
**Risk:** Low (utility script only)

---

### üü¢ LOW (Future Enhancements)

**4. Implement climate advice mapping**

**Location:** `services/analysis-service/app/core/climate.py:43`

**Issue:**
`advice_bucket` is empty list, no advice generation logic.

**Solution:**
Design advice mapping system:
```python
# climate.py:43-60
def _map_advice(self, season: str, imbalance: str) -> List[str]:
    """Map climate imbalance to actionable advice"""
    advice_map = {
        ("winter", "too_cold"): [
            "ÁÅ´Î•º Î≥¥Í∞ïÌïòÏó¨ ÎÇúÍµ≠(ÊöñÂ±Ä)ÏùÑ ÎßåÎìúÏÑ∏Ïöî",
            "ÎÇ®Ï™Ω Î∞©Ìñ•Ïù¥ÎÇò Îî∞ÎúªÌïú ÏÉâÏÉÅÏù¥ Ïú†Î¶¨Ìï©ÎãàÎã§"
        ],
        # ... (define all combinations)
    }
    return advice_map.get((season, imbalance), [])
```

**Expected effort:** 4-6 hours
**Risk:** Low (new feature, no breaking changes)

**5. Update placeholder documentation strings**

**Locations:**
- `services/analysis-service/app/models/analysis.py:19,25`
- `services/analysis-service/tests/test_shensha_v2_policy.py:79,142`
- `services/analysis-service/app/core/engine.py:73,117`

**Issue:**
Docstrings and comments still reference "placeholder" for features that might be complete.

**Solution:**
Review each location and update documentation to reflect current implementation status.

**Expected effort:** 1-2 hours
**Risk:** None (documentation only)

**6. Implement lambda_deg calculation in extrapolate_terms.py**

**Location:** `scripts/extrapolate_terms.py:120`

**Issue:**
Hardcoded "0" for lambda_deg (ecliptic longitude).

**Solution:**
Only implement if precision ‚â• hour-level is required. Current month-level resolution is acceptable for Saju analysis.

**Expected effort:** 3-4 hours (if needed)
**Risk:** Low (utility script only)

---

## Summary Statistics

### Markers by Severity

| Severity | Count | Action Required |
|----------|-------|-----------------|
| CRITICAL | 3 | ‚úÖ YES - blocks production |
| MEDIUM | 4 | ‚úÖ YES - functional gaps |
| LOW | 9 | ‚è≥ OPTIONAL - enhancements |
| FALSE POSITIVE | 4 | ‚ùå NO - templates/docs |
| **TOTAL** | **20** | **7 actionable** |

### Markers by Type

| Type | Count |
|------|-------|
| placeholder | 11 |
| TODO | 2 |
| TBD | 4 |
| XXX | 1 (false positive) |
| mock/stub | 2 |

### Markers by Sector

| Sector | Files Scanned | Markers Found | Status |
|--------|---------------|---------------|--------|
| 1. Policy files | 5 | 0 | ‚úÖ CLEAN |
| 2. Schema files | 9 | 0 | ‚úÖ CLEAN |
| 3. Core engines | 20 | 8 | ‚ö†Ô∏è NEEDS ATTENTION |
| 4. Policy engines | 0 | 0 | N/A |
| 5. Service implementations | 18 | 4 | ‚ö†Ô∏è MINOR ISSUES |
| 6. Test files | 4 | 0 | ‚úÖ CLEAN |
| 7. PSA | 11 | 1 | ‚úÖ CLEAN (false positive) |
| 8. Scripts/utilities | 35 | 7 | ‚ö†Ô∏è MINOR ISSUES |
| **TOTAL** | **102** | **20** | **7 actionable** |

---

## Recommendations

### Immediate (Next Sprint)

1. **üî¥ CRITICAL:** Fix cross-service import architecture by creating `services/common/`
   - Estimated effort: 4-6 hours
   - Blockers: None
   - Owner: Backend team

2. **üü° MEDIUM:** Implement season/month stem adjustments in StrengthEvaluator
   - Estimated effort: 2-3 hours
   - Blockers: strength_policy_v2.json review
   - Owner: Analysis engine team

### Short-term (Next 2-4 weeks)

3. **üü° MEDIUM:** Implement DeltaTPolicy for dt_compare.py
   - Estimated effort: 2-3 hours
   - Blockers: None (can move to `services/common/` after #1)
   - Owner: Scripts/utilities team

4. **üü¢ LOW:** Design and implement climate advice mapping
   - Estimated effort: 4-6 hours
   - Blockers: Advice mapping policy definition needed
   - Owner: Analysis engine team

### Long-term (Next 1-2 months)

5. **üü¢ LOW:** Update all placeholder documentation strings
   - Estimated effort: 1-2 hours
   - Blockers: None (can be done incrementally)
   - Owner: All teams (as features complete)

6. **üü¢ LOW:** Implement lambda_deg calculation (if needed)
   - Estimated effort: 3-4 hours
   - Blockers: Precision requirements clarification
   - Owner: Astro service team

---

## Related Documents

- **FIX_COMPLETE_REPORT.md** - Cross-service import fix documentation (lines 280-355)
- **STAGE2_AUDIT_COMPLETE.md** - Stage 2 audit findings and action plan
- **IMPLEMENTED_ENGINES_AND_FEATURES.md** - Engine inventory and status
- **FEATURE_GAP_ANALYSIS.md** - Known feature gaps and roadmap

---

## Appendix: Full Marker Listing

### Core Engines (8 markers)

```
services/analysis-service/app/core/climate.py:43:
    "advice_bucket": []  # placeholder for future advice mapping

services/analysis-service/app/core/engine.py:73:
    # Strength scoring placeholder.

services/analysis-service/app/core/engine.py:117:
    "notes": "generated by placeholder engine"

services/analysis-service/app/core/luck.py:12:
    # TODO: Fix cross-service imports

services/analysis-service/app/core/luck.py:18:
    """Temporary placeholder for SimpleSolarTermLoader to avoid cross-service import."""

services/analysis-service/app/core/luck.py:24:
    """Temporary placeholder for TimeResolver to avoid cross-service import."""

services/analysis-service/app/core/strength.py:377:
    # Season adjust - placeholder for now

services/analysis-service/app/core/strength.py:380:
    # Month stem effect - placeholder
```

### Service Implementations (4 markers)

```
services/analysis-service/app/models/analysis.py:19:
    """Optional toggles (placeholder for future customization)."""

services/analysis-service/app/models/analysis.py:25:
    """Mapping of stem relationships (placeholder structure)."""

services/analysis-service/tests/test_shensha_v2_policy.py:79:
    # Allow placeholders for now (e.g., <SIG_ELEMENTS>)

services/analysis-service/tests/test_shensha_v2_policy.py:142:
    """P8 ‚Äî Evidence trace structure must be complete (placeholder test)."""
```

### Scripts and Utilities (7 markers)

```
scripts/dt_compare.py:8:
    # TODO: Fix cross-service import - hyphens in module names not supported

scripts/dt_compare.py:13:
    """Temporary placeholder for DeltaTPolicy to fix CI."""

scripts/extrapolate_terms.py:120:
    "lambda_deg": "0",  # placeholder, not needed for month resolution

tools/stage2_audit.py:681:
    **Actual:** TBD

tools/stage2_audit.py:697:
    **Actual:** TBD

tools/stage2_audit.py:713:
    **Actual:** TBD

tools/stage2_audit.py:729:
    # TBD: Add when runtime available
```

---

**Generated by:** Stub/Placeholder Scanner v1.0
**Report date:** 2025-10-09 KST
**Next scan:** After fixing CRITICAL items
