# 지지 십신 정책(branch_tengods_policy v1.1) — Methodology (KO-first)

**엔진명(ko)**: 지지 십신 정책
**버전**: 1.1 · 생성일: 2025-10-05T00:00:00+09:00

## 1) 목적

지지의 장간(藏干) 구성을 일간과 비교하여 **십신(十神)**을 결정하는 규칙을 **정책(JSON)**으로 표준화합니다. 한국 서비스 기준으로 한국어 라벨/툴팁을 기본으로 제공하며, zh/en 라벨을 병기합니다.

## 2) 기본 개념

### 오행 상생/상극(relations.sheng/ke):
- **상생**: 木→火→土→金→水→木
- **상극**: 木克土·土克水·水克火·火克金·金克木

### 음양(陽/陰):
천간의 극성. 甲丙戊庚壬=陽, 乙丁己辛癸=陰.

### 십신 분류(관계 + 음양):
- **동류(같은 오행)**: 同陰陽→비견(BI), 異陰陽→겁재(GE)
- **我生(내가 생함)**: 同→식신(SIK), 異→상관(SANG)
- **我克(내가 극함)**: 同→편재(PJ), 異→정재(JJ)
- **克我(나를 극함)**: 同→편관(PG), 異→정관(JG)
- **生我(나를 생함)**: 同→편인(PI), 異→정인(JI)

## 3) 장간 테이블(요약)

정책의 `branches_hidden`에 12지 각각의 장간(본/중/여)과 오행/음양을 정의합니다.

예: 寅 = 甲(木,陽)[본기], 丙(火,陽)[중기], 戊(土,陽)[여기].

### 역할 가중치(role_weights):
본기 1.0 ≥ 중기 0.6 ≥ 여기 0.3.

## 4) 계산 절차

### 입력:
- 일간(천간) {stem, element, polarity}
- 대상 지지 branch 및 해당 hidden_list[]

### 관계 판정(hidden별):
- same_element / wo_sheng / wo_ke / ke_wo / sheng_wo 중 하나
- parity = same | diff

### 십신 매핑:
`mapping_rules[relation][parity]` → ten_god_code

### 가중치 부여:
local_weight = `role_weights[role]` × 1.0

### 집계:
십신별 가중치를 합산 → (선택) 정규화(normalize=true)

### 후처리:
상위 K(top_k)와 최소치(threshold) 적용, 동률 시 tie_breaker 순서로 정렬.

### 정규화 공식:
```
w'ᵢ = wᵢ / Σⱼwⱼ  (Σᵢw'ᵢ = 1)
```

## 5) KO-first UI 규칙

- **기본 출력 로캘**: ko-KR (options.default_locale).
- **십신/관계명/역할 라벨**은 ko 우선, zh/en 병기 가능.
- **UI 텍스트 키**: ui_labels.ko.relation_*.

## 6) Worked Examples

아래 예시는 정책의 `role_weights: {1.0, 0.6, 0.3}`를 사용합니다.
모든 비율은 정규화 후 소수 4자리로 표기.

### 예시 A — 日主 甲(木,陽), 지지 巳(丙/庚/戊)

**관계**:
- 丙(火,陽): 木→火 (我生) & 同 → 식신(SIK), w=1.0
- 庚(金,陽): 金克木 (克我) & 同 → 편관(PG), w=0.6
- 戊(土,陽): 木克土 (我克) & 同 → 편재(PJ), w=0.3

**합산·정규화**(합=1.9):
- SIK=0.5263, PG=0.3158, PJ=0.1579

### 예시 B — 日主 丙(火,陽), 지지 丑(己/癸/辛)

**관계**:
- 己(土,陰): 我生 & 異 → 상관(SANG), w=1.0
- 癸(水,陰): 克我 & 異 → 정관(JG), w=0.6
- 辛(金,陰): 我克 & 異 → 정재(JJ), w=0.3

**정규화**: SANG=0.5263, JG=0.3158, JJ=0.1579

### 예시 C — 日主 乙(木,陰), 지지 辰(戊/乙/癸)

**관계**:
- 戊(土,陽): 我克 & 異 → 정재(JJ), w=1.0
- 乙(木,陰): 同元素 & 同 → 비견(BI), w=0.6
- 癸(水,陰): 生我 & 同 → 편인(PI), w=0.3

**정규화**: JJ=0.5263, BI=0.3158, PI=0.1579

## 7) Evidence 원칙

- **추적가능성**: hidden별 판정 근거(관계/음양/역할/가중치)와 집계 과정(정규화, top-k)을 모두 기록.
- **KO-first**: 십신 라벨은 label_ko를 기본으로 출력.

## 8) 검증 항목

- 스키마 적합성(필수 키/열거형).
- 역할 가중치 단조성(본≥중≥여).
- 분기 일관성: 음양만 바꾸면 정/편만 전환.
- 정규화 합=1.0(±ε).
- 12지 모두 장간 목록 존재 및 본기 포함.
