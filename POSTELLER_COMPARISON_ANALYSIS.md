# 포스텔러 vs 현재 시스템 비교 분석

**사주:** 2000년 9월 14일 10:00 서울
**사주팔자:** 庚辰 乙酉 乙亥 辛巳
**일간:** 乙木

---

## 📊 비교 결과 요약

### 오행 분포 비교

| 오행 | 포스텔러 | 현재 시스템 | 차이 | 상태 |
|------|---------|-----------|------|------|
| **金** | 37.5% | **50.0%** | +12.5% | 🔴 큰 차이 |
| **木** | 25.0% | 25.0% | 0.0% | ✅ 일치 |
| **火** | 12.5% | **0.0%** | -12.5% | 🔴 큰 차이 |
| **水** | 12.5% | 12.5% | 0.0% | ✅ 일치 |
| **土** | 12.5% | 12.5% | 0.0% | ✅ 일치 |

### 십신 분포 비교

| 십신 | 포스텔러 | 현재 시스템 | 차이 | 상태 |
|------|---------|-----------|------|------|
| 比肩 | 25.0% | 23.1% | -1.9% | ✅ 거의 일치 |
| 劫財 | 0.0% | 7.7% | +7.7% | 🟡 차이 있음 |
| 食神 | 0.0% | 0.0% | 0.0% | ✅ 일치 |
| 傷官 | 0.0% | 7.7% | +7.7% | 🟡 차이 있음 |
| 偏財 | 0.0% | 0.0% | 0.0% | ✅ 일치 |
| 正財 | 12.5% | 15.4% | +2.9% | ✅ 거의 일치 |
| **偏官** | **25.0%** | **0.0%** | **-25.0%** | 🔴 **용어 차이!** |
| **七殺** | **0.0%** | **15.4%** | **+15.4%** | 🔴 **용어 차이!** |
| 正官 | 12.5% | 15.4% | +2.9% | ✅ 거의 일치 |
| 偏印 | 0.0% | 7.7% | +7.7% | 🟡 차이 있음 |
| 正印 | 12.5% | 7.7% | -4.8% | ✅ 거의 일치 |

---

## 🔍 원인 분석

### 1️⃣ **지장간(地藏干) 계산 방식 확인**

**현재 시스템 정책 (branch_tengods_policy.json):**

```json
{
  "辰": [
    {"stem":"戊","element":"土","role":"primary"},
    {"stem":"乙","element":"木","role":"secondary"},
    {"stem":"癸","element":"水","role":"tertiary"}
  ],
  "酉": [
    {"stem":"辛","element":"金","role":"primary"}
  ],
  "亥": [
    {"stem":"壬","element":"水","role":"primary"},
    {"stem":"甲","element":"木","role":"secondary"}
  ],
  "巳": [
    {"stem":"丙","element":"火","role":"primary"},
    {"stem":"庚","element":"金","role":"secondary"},
    {"stem":"戊","element":"土","role":"tertiary"}
  ]
}
```

**사주 구성 상세:**

#### 천간 (4개)
- 庚 (金) - 년간
- 乙 (木) - 월간
- 乙 (木) - 일간 ⭐
- 辛 (金) - 시간

#### 지지 지장간 (9개)
- **辰** (3개): 戊(土) + 乙(木) + 癸(水)
- **酉** (1개): 辛(金)
- **亥** (2개): 壬(水) + 甲(木)
- **巳** (3개): 丙(火) + 庚(金) + 戊(土)

#### 전체 오행 개수 (천간 4 + 지장간 9 = 13개)

| 오행 | 천간 | 지장간 | 합계 | 비율 |
|------|-----|-------|------|------|
| **金** | 庚, 辛 (2) | 辛(酉), 庚(巳) (2) | **4** | 30.8% |
| **木** | 乙, 乙 (2) | 乙(辰), 甲(亥) (2) | **4** | 30.8% |
| **火** | - (0) | 丙(巳) (1) | **1** | 7.7% |
| **水** | - (0) | 癸(辰), 壬(亥) (2) | **2** | 15.4% |
| **土** | - (0) | 戊(辰), 戊(巳) (2) | **2** | 15.4% |

**⚠️ 계산 불일치 발견!**

현재 시스템이 표시한 오행 비율:
- 金: 50.0% (예상: 30.8%)
- 木: 25.0% (예상: 30.8%)
- 火: 0.0% (예상: 7.7%)

---

### 2️⃣ **火 오행 차이 원인**

**포스텔러:**
- 巳(火) 지지 자체를 火로 인정 → 12.5%

**현재 시스템:**
- 지장간 丙(火)만 계산
- 하지만 elements_distribution에서 火=0.0%로 표시 ⚠️
- **버그 가능성:** 지장간 丙이 오행 계산에 누락?

---

### 3️⃣ **偏官 vs 七殺 명칭 차이**

**동일한 십신, 다른 용어:**

| 포스텔러 | 현재 시스템 | 의미 |
|---------|-----------|------|
| 偏官 | 七殺 | 같은 십신 (음양 다른 관살) |
| - | - | 辛(金) → 乙(木) = 七殺 |

**합산 결과:**
- 포스텔러: 偏官 25.0%
- 현재: 七殺 15.4% (차이는 계산 방식 차이)

---

### 4️⃣ **천간 vs 지지 가중치**

**전통 사주 이론:**
- 천간 (투출): 드러난 기운, 영향력 큼 → 가중치 높음
- 지지 (지장간): 숨은 기운, 영향력 작음 → 가중치 낮음

**포스텔러 추정 계산:**
```
천간 4개 × 2.0 (가중치) = 8
지지 4개 × 1.0 (가중치) = 4
총합 = 12

金: 天干(庚辛)=4 + 地支(酉)=1 = 5/12 = 41.7%?
실제 포스텔러: 37.5%
```

**현재 시스템:**
```
천간 4개 + 지장간 9개 = 13 (동등 가중치)

金: 4개/13 = 30.8%
하지만 표시: 50.0% ⚠️
```

---

## 🎯 결론 및 권장사항

### ✅ 확인된 차이점

1. **오행 계산 방식**
   - 포스텔러: 천간/지지 가중치 적용 (추정)
   - 현재: 천간 + 지장간 개수 단순 합산
   - **결과:** 金 37.5% vs 50.0%

2. **火 오행 누락**
   - 포스텔러: 巳(火) 본기 인정 → 12.5%
   - 현재: 지장간 丙만 계산했으나 표시 0.0% ⚠️
   - **문제:** elements_distribution 계산 버그 가능성

3. **십신 용어**
   - 포스텔러: "偏官" 용어 사용
   - 현재: "七殺" 용어 사용
   - **문제 없음:** 같은 십신, 다른 이름

4. **지장간 개수**
   - 양 시스템 모두 동일한 지장간 구조 사용
   - 차이는 가중치 적용 방식

### 🔴 발견된 버그

**현재 시스템 elements_distribution 계산 오류:**

```python
# 예상 값 (개수 기반)
{
  "金": 0.308,  # 4/13
  "木": 0.308,  # 4/13
  "火": 0.077,  # 1/13
  "水": 0.154,  # 2/13
  "土": 0.154   # 2/13
}

# 실제 반환 값
{
  "金": 0.50,   # ❌ 62% 증가
  "木": 0.25,   # ❌ 19% 감소
  "火": 0.00,   # ❌ 100% 감소 (丙 누락!)
  "水": 0.125,  # ✅ 거의 맞음
  "土": 0.125   # ✅ 거의 맞음
}
```

### 📋 권장 조치

#### 우선순위 1 (긴급)
- [ ] **elements_distribution 계산 로직 검증**
  - 火 오행이 0.0%로 나오는 버그 수정
  - 지장간 丙(火)이 계산에 포함되는지 확인
  - 金 오행 50%가 정확한지 검증

#### 우선순위 2 (중요)
- [ ] **가중치 정책 결정**
  - 포스텔러 방식: 천간/지지 가중치 적용
  - 현재 방식: 동등 가중치
  - 전통 사주 문헌 기준 확인 필요

#### 우선순위 3 (개선)
- [ ] **용어 통일**
  - 偏官 vs 七殺: 둘 다 제공하거나 하나로 통일
  - 사용자 선호도 조사

---

## 📚 참고: 전통 사주 지장간 표준

| 지지 | 주기 | 중기 | 여기 | 일수 |
|-----|-----|-----|-----|-----|
| 子 | 癸 (水) | - | - | 30일 |
| 丑 | 己 (土) | 癸 (水) | 辛 (金) | 9/18/3일 |
| 寅 | 甲 (木) | 丙 (火) | 戊 (土) | 7/7/16일 |
| 卯 | 乙 (木) | - | - | 30일 |
| 辰 | 戊 (土) | 乙 (木) | 癸 (水) | 9/18/3일 |
| 巳 | 丙 (火) | 庚 (金) | 戊 (土) | 7/7/16일 |
| 午 | 丁 (火) | 己 (土) | - | 10/20일 |
| 未 | 己 (土) | 丁 (火) | 乙 (木) | 9/18/3일 |
| 申 | 庚 (金) | 壬 (水) | 戊 (土) | 7/7/16일 |
| 酉 | 辛 (金) | - | - | 30일 |
| 戌 | 戊 (土) | 辛 (金) | 丁 (火) | 9/18/3일 |
| 亥 | 壬 (水) | 甲 (木) | - | 10/20일 |

**가중치 계산 옵션:**
1. **개수 기반**: 각 지장간 1점씩
2. **일수 기반**: 주기 > 중기 > 여기 차등
3. **천간 우대**: 천간 2점, 지장간 1점

---

**작성일:** 2025-01-31
**시스템 버전:** analysis-service v1.2.0
**상태:** 🔴 버그 수정 필요 (elements_distribution 계산)
